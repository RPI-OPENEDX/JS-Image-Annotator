<html>
<head>

<script>
	var imgSrc = location.search.split('img=')[1] ? location.search.split('img=')[1] : 'myDefaultValue';
var note_type = "stickers/check.png";
var editor_type = "draw"; 
</script>

<script>
function blackNote() {
  if (1==1){
    var $mybits = $(document.createElement('span'));
    var style = {"display":"block",
        "width":"50px",
        "height":"50px",
        "background":"url(" + note_type + ") no-repeat",
        "background-size":"cover",
        "z-index":"10",
        "position":"absolute"};
    $mybits.css(style);
    return $mybits;
  }

  if (note_type == 1) {
    return $(document.createElement('span')).addClass('black circle note');
  }else{
     return $(document.createElement('span')).addClass('set-label');
  }
}


function toggle_edit_type() {
  if (editor_type == "draw") {
    editor_type = "sticker";
    document.getElementById('draw_settings').style.display = "none";
    document.getElementById('sticker_settings').style.display = "block";
    document.getElementById('enable_editing').innerHTML = "Editor Mode:Sticker";
    document.getElementById('gameCanvas').style.zIndex = "1";
  }else if (editor_type == "sticker") {
    editor_type = "draw";
    document.getElementById('draw_settings').style.display = "block";
    document.getElementById('sticker_settings').style.display = "none";
    document.getElementById('enable_editing').innerHTML = "Editor Mode:Draw";
    document.getElementById('gameCanvas').style.zIndex = "2";
  }
}

</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="js/jquery.annotate.js"></script>
<script src="js/sketch.js"></script>
<script src="js/html2canvas.js"></script>
<script src="js/jspdf.js"></script>
<script src="js/addhtml.js"></script>
<script src="js/split_text_to_size.js"></script>
<script src="js/standard_fonts_metrics.js"></script>
<script src="js/addimage.js"></script>
<script src="js/from_html.js"></script>
<script src="js/png_support.js"></script>
<script src="js/png.js"></script>
<script src="js/zlib.js"></script>
<script src="js/FileSaver.min.js"></script>
<style>
span.note,span.set-label,span.wrap {
	-webkit-box-sizing:content-box;
	-moz-box-sizing:content-box;
	box-sizing:content-box;
}
span.wrap {
	padding:10px;
}
#js-annotation-page>.row {
	margin-bottom:1em;
}
</style>
</head>
<body>
<div id="toAnnotate">
<canvas id="gameCanvas" width="500" height="650" style="position: absolute; left: 0; top:0; z-index: 2;"></canvas>
<img src="images/1x1_transparent.png" id="annotateMe" style="position: absolute; height: 650px; width: 500px; left: 0; top: 0; z-index:1; ">
</div>
<script>
n = document.createElement('img'); // create an image element
n.src = imgSrc; // relative path to the image
n.id = 'userDoc';
n.style.position = "absolute";
n.style.height="650px";
n.style.width="500px";
n.style.left= "0";
n.style.top= "0";
n.style.zIndex= "0";
document.getElementById('toAnnotate').appendChild(n); // append the image to the body

	
	$('#toAnnotate').annotatableImage(blackNote);
</script>
<script type="text/javascript">
  $(function() {
    $('#gameCanvas').sketch();
  });
</script>

<div id="editor" style="position: absolute; left: 500px; top: 0px; z-index:1000; background-color: white;">
<button type="button" id="enable_editing" onclick="toggle_edit_type()">Editor Mode:Draw</button>
<button type="button" id="download">Save PDF</button>
<br><br><br>
<div id="draw_settings" style="display:block; width:32px;">

<script type="text/javascript">
  $(function() {
    $.each(['#f00', '#ff0', '#0f0', '#0ff', '#00f', '#f0f', '#000', '#fff'], function() {
      $('#draw_settings').append("<a href='#gameCanvas' data-color='" + this + "' style='width:32px; background: " + this + "; display: inline-block; border: 1px solid #000; height: 30px; line-height: 30px;'></a><br> ");
    });
    $.each([3, 5, 10, 15, 100], function() {
      $('#draw_settings').append("<a href='#gameCanvas' data-size='" + this + "' style='background: #ccc; display: inline-block; border: 1px solid #000; height: 30px; width: 100%; line-height: 30px; text-align: center;'>" + this + "</a><br> ");
    });
  });
</script>
</div>
<div id="sticker_settings" style="display:none;">
<div id="active_sticker">
<img id="sticker_in_use" src='stickers/check.png' style='width:50px; height:50px;'>
</div> <br><br>
<div id="sticker_list" style="overflow: scroll; width: 100px; height: 525px;">
</div>
<script>

$.get('resource', function(data){
  var stickers = data.split('\n');
    for (var i = 0, num = stickers.length; i < num - 1; ++i){
      var sticker_meta = stickers[i].split('/');
      $("#sticker_list").append($("<img src=" + stickers[i] + " id=" + sticker_meta[2] + " class=" + sticker_meta[1] + " style='width:50px; height:50px;'></img>"));    
    }
});
</script>
</div>
</div>

 <form style="padding-top:650px">
Grader Name:<br>
<input type="text" name="firstname">
<br>
Grader Score:<br>
<input type="text" name="lastname">
</form>
Grader Comments:<br>
<textarea rows="10" cols="50"></textarea>
</body>
<footer>
<script>
$('#download').click(function() {       
    html2canvas(document.body, {
      onrendered: function(canvas) {         
        var imgData = canvas.toDataURL('image/png');              
        var doc = new jsPDF('p', 'mm');
        doc.addImage(imgData, 'PNG', 10, 10);
        doc.save('sample-file.pdf');
        }
      });
});

$( document ).on("click", "img.emoticons, img.stickers", function() {
note_type = this.getAttribute("class") + '/' + this.getAttribute("id");  
$("img#sticker_in_use").attr('src', note_type);
});



</script>
</footer>
</html>
